<!DOCTYPE html>
<html lang="zh-cmn-Hans">
    <head>
        <meta charset="UTF-8" />
        <title>Product手册</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
        <meta name="renderer" content="webkit" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <!--<meta name="screen-orientation" content="portrait">-->
        <!--<meta name="x5-orientation" content="portrait">-->
        <meta name="format-detection" content="telephone=no" />
        <meta name="author" content="nop" />
        <meta name="generator" content="wkhtmltopdf" />
        <link
            rel="shortcut icon"
            href="./static/img/nop.jpg"
            type="image/x-icon"
        />
        <meta name="description" content="" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0"
        />
        <script src="./static/js/polyfill.min.js"></script>
        <script src="./static/js/jquery.min.js"></script>
        <script src="./static/js/lodash.min.js"></script>
        <script src="./static/js/bookjs/latest/bookjs-eazy.min.js"></script>
    </head>

    <body>
        <style>
            h1,
            h2,
            h3,
            h4 {
                font-weight: 600;
                padding-bottom: 1.5em;
                padding-top: 2.5em;
                height: 20mm;
            }

            h1 {
                font-size: 1.6rem;
                text-align: center;
            }

            h2 {
                font-size: 1.5rem;
                text-align: center;
            }

            h3 {
                font-size: 1.4rem;
            }

            h4 {
                font-size: 1.3rem;
            }

            p {
                text-indent: 2em;
                letter-spacing: 0.1em;
                font-weight: 400;
                line-height: 1.5;
                padding: 0.3em 0 0.3em 0;
            }

            p.nop-link-last {
                text-indent: 0;
            }

            .nop-page-item .chapter-mark {
                padding-top: 3rem;
                font-size: 0.9rem;
                color: #666;
                padding-left: 2.5cm;
                padding-right: 2.5cm;
                position: absolute;
                top: 0;
            }

            .nop-page-item.nop-page-item-even .chapter-mark {
                right: 0;
            }

            .nop-page-item.nop-page-item-odd .chapter-mark {
                left: 0;
            }

            .nop-page-item .volume-mark {
                position: absolute;
                width: 50px;
                height: 120px;
                top: 300px;
                background-color: crimson;
                line-height: 1.2;
            }

            .nop-page-item .volume-0.volume-mark {
                background-color: #1922dc;
            }

            .nop-page-item .volume-1.volume-mark {
                background-color: #dc6f0d;
            }

            .nop-page-item .volume-2.volume-mark {
                background-color: #09dc18;
            }

            .nop-page-item .volume-3.volume-mark {
                background-color: #b114dc;
            }

            .nop-page-item .volume-4.volume-mark {
                background-color: #dadc2b;
            }

            .nop-page-item .volume-5.volume-mark {
                background-color: #26dca9;
            }

            .nop-page-item .volume-6.volume-mark {
                background-color: #5652dc;
            }

            .nop-page-item .volume-7.volume-mark {
                background-color: #1f89dc;
            }

            .nop-page-item .volume-8.volume-mark {
                background-color: #dc160d;
            }

            .nop-page-item .volume-9.volume-mark {
                background-color: #4edc0e;
            }

            .nop-page-item .volume-10.volume-mark {
                background-color: #1982dc;
            }

            .nop-page-item.nop-page-item-even .volume-mark {
                right: 0;
                border-radius: 5px 0 0 5px;
            }

            .nop-page-item.nop-page-item-odd .volume-mark {
                left: 0;
                border-radius: 0 5px 5px 0;
            }

            .nop-page-item .volume-mark > span {
                text-align: center;
                font-weight: 600;
                color: #fff;
                width: 100%;
                justify-content: center;
                font-size: 0.9rem;
                letter-spacing: 0.3em;
                height: auto;
                display: block;
                padding: 1.8em;
                line-height: 1.5em;
            }

            .nop-page-item.nop-page-item-odd .volume-mark > span {
                padding-right: 12px;
                padding-right: 12px;
            }

            .nop-page-item.nop-page-item-even .volume-mark > span {
                padding-left: 12px;
                padding-right: 12px;
            }
        </style>
        <style>
            .catalog-level {
                padding: 0 4mm;
            }

            .my-header {
                background-color: #1a5fa9 !important;
                font-weight: bold;
                color: #fff;
                display: flex;
                align-items: center;
                border: 1px solid #666;
                padding: 1mm;
                box-sizing: border-box;
            }

            .my-content-box {
                display: flex;
                align-items: center;
                border: 1px solid #666;
                border-top: 0;
                box-sizing: border-box;
                padding: 1mm 0;
                position: relative;
            }

            .my-content-left {
                width: 27mm;
                height: 100%;
                display: flex;
                align-items: center;
                padding: 0 1mm;
                box-sizing: border-box;
            }
            .my-content-middle {
                border-right: 1px solid #666;
                width: 0px;
                height: 100%;
                left: 27mm;
                position: absolute;
            }
            .my-content-right {
                box-sizing: border-box;
                /* width: 70mm; */
                vertical-align: middle;
                height: 100%;
                flex: 1;
                display: flex;

                align-items: center;
                padding: 0 1mm;
            }

            .content-text {
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 4;
                width: 100%;
            }

            .my-content-box:nth-child(odd) {
                color: #000;
                background-color: #f2f2f2;
            }

            .my-content-box:nth-child(even) {
                color: #000;
                background-color: #fff;
            }

            .page-num-simple {
                /* display: flex; */
                position: relative;
                text-align: center;
                bottom: 7mm;
                font-weight: 500;
                font-size: 14px;
                color: #aaa;
            }

            h3 {
                /* display: none; */
                position: absolute;
                left: -9999px;
            }

            h2 {
                /* display: none; */
                position: absolute;
                left: -9999px;
            }

            h4 {
                /* display: none; */
                position: absolute;
                left: -9999px;
            }

            .nop-page-item.nop-page-item-odd .two-category {
                color: #777;
                font-size: 1.3rem;
            }

            .nop-page-item.nop-page-item-odd .three-category {
                /* color: #777; */
                font-size: 1.3rem;
                font-weight: bold;
            }

            .my-category-title-box {
                line-height: 2em;
            }

            /* .item-even */

            .nop-page-item.nop-page-item-odd .volume-mark.my-page-title {
                top: 0;
                width: 100%;
                height: 15mm;

                background-repeat: no-repeat;
                background-color: #f5911d;
                background-size: auto 100%;

                padding-left: 70mm;
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                color: white;
                border-radius: 0;
            }
            .nop-page-item.nop-page-item-even .volume-mark.my-page-title {
                top: 0;
                width: 100%;
                height: 15mm;
                background-repeat: no-repeat;
                background-color: #f5911d;
                background-size: auto 100%;
                background-position: right;
                padding-right: 70mm;
                display: flex;
                align-items: center;
                text-align: right;
                justify-content: flex-end;
                flex-wrap: wrap;
                color: white;
                border-radius: 0;
            }

            .page-title-item {
                width: 100%;
            }

            .item-title {
                font-size: 16px;
                font-weight: bold;
                line-height: 18px;
                text-transform: uppercase;
            }

            .item-des {
                font-size: 10px;
                line-height: 12px;
                text-transform: uppercase;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 1;
                text-align: left;
                /* width: 100%; */
                /* padding-right: 10mm; */
                width: 136mm;
            }

            .catalog-level.catalog-level-1 .catalog-item-title a {
                font-weight: bold;
                font-size: 24px;
                color: #000;
            }

            .catalog-level.catalog-level-2 .catalog-item-title a {
                font-size: 24px;
                font-weight: bold;
                color: blue;
            }

            .nop-page-content .catalog-item-pagenum a {
                color: orange;
                font-weight: bold;
                font-size: 24px;
            }

            .catalog-level.catalog-level-3 .catalog-item-title a {
                font-size: 24px;
                font-weight: bold;
                color: orange;
            }

            .catalog-title {
                display: none;
            }

            .height-page {
                height: 290mm;
                /* background-color: #09dc18; */
            }
        </style>
        <style>
            .my-base-page {
                display: flex;
                width: 100%;
                /* background-color: #26dca9; */
                padding: 15mm 10mm;
                padding-top: 18mm;
                color: #000;
                font-size: 3mm;
            }

            .my-base-left {
                /* width: 210 /2; */
                width: 104mm;
                height: 260mm;
                /* background-color: #1f89dc; */
                /* border-right: 1px dashed #ccc; */
                /* border-style: dashed; */
                padding-right: 2mm;
                box-sizing: border-box;
            }
            .shu-dashed {
                width: 0px;
                height: 260mm;
                border-right: 1px dashed #ccc;
            }
            .my-base-right {
                box-sizing: border-box;
                width: 104mm;
                /* background-color: #666; */
                height: 260mm;
                padding-left: 2mm;
            }

            .my-page-category-title {
                font-size: 14px;
                display: flex;
                align-items: center;
            }

            .two-level-title {
                color: #999999;
                font-weight: 500;
                line-height: 1.1;
            }

            .three-level-title {
                color: #000000;
                line-height: 1.1;
                font-weight: bold;
            }

            .category-spilt {
                color: #000000;
                display: flex;
                height: 100%;
                align-items: center;
            }

            .my-page-num-simple {
                position: absolute;
                bottom: 0;
                bottom: 7mm;
                left: 0;
                /* line-height: 10mm; */
                width: 100%;
                text-align: center;
                box-sizing: border-box;
                color: #999999;
            }

            .my-page-num-simple .page-num-left {
                color: #f5911d;
                font-size: 20px;
                font-weight: bold;
                position: absolute;
                left: 10mm;
            }

            .my-page-num-simple .page-num-right {
                color: #f5911d;
                font-size: 20px;
                font-weight: bold;
                position: absolute;
                right: 10mm;
            }

            .my-copyright {
                color: #000;
            }
        </style>
        <style>
            /* .nop-page-item-pagenum-1 {
            display: none;
        } */

            .flex-content {
                display: flex;
                /* padding-top: 6mm; */
                padding: 20mm 10mm 10mm;
            }

            .flex-content .col {
                padding: 0 4mm 0 7mm;
                border-right: 1px dashed #ccc;
                height: 260mm;
                width: 33.3%;
                align-items: center;
            }

            .flex-content .col-1 {
                padding-left: 4mm;
            }

            .flex-content .col-3 {
                padding-right: 0mm;
                border-right: 0;
            }

            .flex-content .item {
                display: flex;
                align-items: center;
                position: relative;
                height: 6mm;
            }

            .item .left {
                position: absolute;
                background-color: white;
                left: 0;
                height: 100%;
                height: 6mm;
                top: 0;
                padding-right: 2mm;
            }

            .item .dashed {
                width: 100%;
                height: 1px;
                border-top: 1px dashed #333;
            }

            .item .right {
                position: absolute;
                right: 0;
                height: 100%;
                background-color: white;
                height: 6mm;
                top: 0;
                padding-left: 2mm;
            }

            .level1 {
                color: #000;
                font-weight: 700;
            }

            .my-icon-box {
                position: absolute;
                z-index: 999;
                left: -3mm;
                top: 2mm;
                height: 2mm;
                width: 3mm;
                display: flex;
            }

            .my-icon-left {
                background-color: orange;
                width: 1mm;
            }

            .my-icon-right {
                background-color: #1a5fa9;
                width: 0.5mm;
            }

            .level2 {
                text-indent: 4mm;
                color: #1a5fa9;
                font-weight: 500;
            }

            .level3 {
                color: #f5911e;
                text-indent: 8mm;
                font-weight: 500;
            }

            .yema {
                font-weight: bold;
                color: #f5911e;
            }

            .my-href {
                color: unset;
                text-decoration: none;
                line-height: 6mm;
            }

            .my-title-header {
                position: absolute;
                top: 0mm;
                left: 0;
                z-index: 10000;
                /* background-image: url("./asset/en/pagelogo.png"); */
                height: 15mm;
                width: 100%;
                background-size: auto 100%;
                background-color: #f5911e;
                background-repeat: no-repeat;
                display: flex;
                align-items: center;
            }

            .my-title-header .my-header-text {
                color: white;
                font-size: 16px;
                padding-left: 70mm;
                font-weight: 500;
            }

            .coverImg {
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                z-index: 1000;
            }
            .coverImg .ercode-top {
                position: absolute;
                right: 30px;
                z-index: 1000;
                bottom: 80px;
                width: 180px;
                height: 180px;
            }

            .coverImg .ercode-bottom {
                position: absolute;
                right: 50%;
                transform: translateX(50%);
                z-index: 1000;
                bottom: 46px;
                width: 180px;
                height: 180px;
            }
        </style>
        <input type="file" id="fileInput" style="display: none" />
        <div id="content-box" style="display: none"></div>
        <script>
            bookConfig = {
                pageSize: "ISO_A4",
                orientation: "portrait",

                // simplePageNum: {
                //     pageBegin: "#voucher-title-0",
                //     pendant: '<div class="page-num-simple": "><span class="page-num-${PAGE%2==0?\'right\':\'left\'}">${PAGE >9?PAGE:"0"+PAGE}</span><span>FridayParts Copyright ◎ 2024 All rights reserved</span></div>',
                // },
                padding: "0",
                toolBar: {
                    serverPrint: {
                        wkHtmlToPdf: true,
                        params: {
                            // 打印超时时间
                            timeout: 60000,
                        },
                    },
                    webPrint: true,
                    saveHtml: true,
                },
                start: false,
                // simpleCatalog: {
                //     titlesSelector: "h2,h3,h4,h5",
                //     showCatalog: true
                // },
            };
        </script>
        <script>
            function getParams(url) {
                const params = {};
                const urlParts = url.split("?");

                if (urlParts.length > 1) {
                    const queryString = urlParts[1];
                    const pairs = queryString.split("&");

                    pairs.forEach((pair) => {
                        const keyValue = pair.split("=");
                        const key = decodeURIComponent(keyValue[0]);
                        const value = decodeURIComponent(keyValue[1]);
                        params[key] = value;
                    });
                }

                return params;
            }

            //

            var renderCover = function (path) {
                const str = `<div data-op-type="block" class="my-base-page"  style="height:296mm" >
                    <div class="coverImg">
                        <img src="${path}"  />    
                    </div>
                </div>`;

                return str;
            };
            var renderCoverERCode = function (path, ercode, ercodeClass) {
                const str = `<div data-op-type="block" class="my-base-page"  style="height:296mm" >
                    <div class="coverImg">
                        <img src="${path}"  />   
                        ${
                            ercode
                                ? `<img src="${ercode}" class="${ercodeClass}"  />`
                                : ""
                        }    
                    </div>
                </div>`;
                return str;
            };
            function getPropsStr(item) {
                const str = `<div class="my-content-box" style="height:${item.height}mm"> 
                    <div class="my-content-left">
                        ${item.key}
                    </div>
                    <div class="my-content-middle">
                       
                    </div>
                    <div class="my-content-right">
                        <div class="content-text">
                            ${item.value}    
                        </div>
                    </div>
                </div>`;

                return item.value ? str : "";
            }
            function getPageHedaerStr(oneCategoryData, i) {
                console.log(oneCategoryData);
                // const categoryShortDescription = oneCategoryData.categoryShortDescription.replac
                // const categoryShortDescription = oneCategoryData.categoryShortDescription?.replace(/<.*?>/g, '')
                // console.log(categoryShortDescription);

                const str = `
                <div data-op-type="pendants" class=""> 
                    <div class="volume-mark volume-${i} my-page-title ">
                        <div>
                            <div class="page-title-item item-title">
                            ${currentConfig.pagetoptext.replace(
                                /{{brand}}/g,
                                oneCategoryData.categoryName
                            )} 
                            </div>
                        </div>
                    </div>
                </div>
                `;
                return str;
            }
            function redenrOneCategory(pageList, parentIndex, oneCategoryData) {
                // debugger
                const oneCategoryStr = [];
                // console.log(`pageList`, pageList);

                function getHalfStr(typeList, direct) {
                    let halfStr = "";
                    for (let index = 0; index < typeList.length; index++) {
                        const item = typeList[index];
                        if (item.type === "product") {
                            if (item.key == "productName") {
                                halfStr += ` 
                            <div class="my-header" style="height:${item.height}mm">
                                <div class="content-text"> ${item.value}</div>
                            </div> `;
                            } else {
                                halfStr += getPropsStr(item);
                            }
                        } else if (item.type === "title") {
                            halfStr += `
                        <h${item.hNumber} id="voucher-title-${parentIndex}-${
                                item.index
                            }" > ${item.content} </h${item.hNumber}>
                        <div  class="my-page-category-title"  style="height: ${
                            item.height
                        }mm ; display: ${!item.height ? "none" : ""};"> 
                            <span class="two-level-title">${
                                item.preCategory
                            } </span>
                            <span class="category-spilt">&nbsp;/&nbsp;</span>
                            <span class="three-level-title">${
                                item.content
                            }</span>
                        </div>
                    `;
                            if (direct === "left") {
                                oneCategoryStr.push(
                                    getPageHedaerStr(
                                        oneCategoryData,
                                        parentIndex
                                    )
                                );
                            }
                        } else if (item.type === "split") {
                            halfStr += `
                        <div class="my-page-split" style="height: 2mm" > </div>
                    `;
                        }
                    }
                    return halfStr;
                }
                for (let i = 0; i < pageList.length; i++) {
                    const page = pageList[i];
                    // console.log(`当前页面是`, page);
                    if (!page) {
                        oneCategoryStr.push(
                            `<div data-op-type="new-page"></div>`
                        );
                        continue;
                    }
                    console.log(`当前页面是`, page);

                    let leftStr = getHalfStr(page.leftList, "left");
                    const rightStr = getHalfStr(page.rightList, "right");
                    let temp = `
            <div data-op-type="block" class="my-base-page"  style="height:296mm" >
                <div class="my-base-left">
                    ${leftStr}
                </div>
                <div class="shu-dashed"></div>
                <div class="my-base-right">
                    ${rightStr}
                </div>

                <div class="my-page-num-simple">
                    <span class="page-num-${
                        page.pageNumber % 2 == 0 ? "right" : "left"
                    }">
                        ${
                            page.pageNumber > 9
                                ? page.pageNumber
                                : "0" + page.pageNumber
                        }
                    </span>
                    <span>${
                        page.pageNumber % 2 == 0
                            ? currentConfig.copyright_text
                            : currentConfig.copyright_text_2
                    }
                </div>
            </div>
            `;
                    oneCategoryStr.push(temp);
                }

                return oneCategoryStr;
            }
            function renderProductPage(data) {
                const productStrArr = [];
                for (let index = 0; index < data.length; index++) {
                    const oneCategoryData = data[index];
                    const pageList = oneCategoryData.pageList;
                    const oneTile = `<h2 id="voucher-title-${index}" >${oneCategoryData.categoryName}  </h2>`;
                    productStrArr.push(oneTile);
                    const categoryStr = redenrOneCategory(
                        pageList,
                        index,
                        oneCategoryData
                    );
                    productStrArr.push(...categoryStr);
                    if (index === data.length - 1) {
                        console.log(index);
                        break;
                    } else {
                        productStrArr.push(
                            `<div data-op-type="new-page"></div>`
                        );
                    }
                }
                return productStrArr;
            }

            // 目录 一栏
            function getCol(list) {
                let str = "";
                for (let i = 0; i < list.length; i++) {
                    const item = list[i];
                    str += `
                <div class="item" style="height:6mm">
                    ${
                        item.level == 1
                            ? `<div class="my-icon-box">
                            <div class="my-icon-left"></div>
                            <div class="my-icon-right"></div>
                    </div>`
                            : ""
                    }
                    <div class="content left level${item.level}">
                        <a class="my-href" href="${item.href}">${item.title}</a>
                    </div>
                    <div class="dashed">
                        <a class="my-href" href="${item.href}"></a>
                    </div>
                    <div class="yema right">
                        <a class="my-href" href="${item.href}">${item.page}</a>
                    </div>
                </div>
            `;
                }
                return str;
            }
            // 渲染目录
            function renderOnepageTitle(page) {
                const leftStr = getCol(page.leftList);
                const middleStr = getCol(page.middleList);
                const rightStr = getCol(page.rightList);

                let pageStr = `
            <div data-op-type="block" class="flex-content">
                <div class="col-1 col">
                    ${leftStr}
                </div>
                <div class="col-2 col">
                    ${middleStr}
                </div>
                <div class="col-3 col">
                    ${rightStr}
                </div>
            </div>
            `;
                return pageStr;
            }
            function renderTitle(tittlePages) {
                const pageList = tittlePages;
                const pagesStr = [];
                for (let i = 0; i < pageList.length; i++) {
                    const page = pageList[i];
                    if (page) {
                        pagesStr.push(`
                    <div class="my-title-header" style="background-image: url(${currentConfig.page_logo_src_left})">
                        <div class="my-header-text">
                        ${currentConfig.index_title}
                        </div>

                    </div>`);

                        pagesStr.push(renderOnepageTitle(page));
                    } else {
                        pagesStr.push(`<div data-op-type="new-page"></div>`);
                    }
                }

                return pagesStr;
            }
            // 开始渲染

            async function renderBook() {
                const productData = await $.getJSON(
                    "./clearData/productInfo.json"
                );
                const titleData = await $.getJSON(
                    "./clearData/titlePages.json"
                );
                //
                const config = await $.getJSON("./config.json");
                const params = getParams(window.location.href);
                console.log(`params`, params);
                const currentConfig = config[params.lang];
                window.currentConfig = currentConfig;
                console.log(`currentConfig`, currentConfig);
                const list = [];
                currentConfig.first_img_list.forEach((item) => {
                    const coverStr = renderCover(item);
                    list.push(coverStr);
                    list.push('<div data-op-type="new-page" />');
                });
                list.push(...renderTitle(titleData));
                list.push(...renderProductPage(productData));
                // console.log(`pageNumber` ,pageNumber);

                const indexPageLength = titleData.filter((item) => item).length;
                console.log(`目录总共 ${indexPageLength} 页 `, indexPageLength);
                const productPageLength = productData
                    .reduce((acc, current) => {
                        acc.push(...current.pageList.filter((item) => item));
                        return acc;
                    }, [])
                    .filter((item) => item).length;
                console.log(
                    `产品总共${productPageLength} 页`,
                    productPageLength
                );
                // 奇数偶数插页问题,因为最终要拿到 偶数的图书去打印, 奇数的情况下要去补充一张图,凑成偶数.
                const beforePageLength =
                    productPageLength +
                    indexPageLength +
                    currentConfig.first_img_list.length;
                console.log(
                    `开始进行 页面尾部插图. , 当前 beforePageLength`,
                    beforePageLength
                );

                if (beforePageLength % 2 == 0) {
                    const odd = renderCover(
                        currentConfig.odd_even_fill_img_list
                    );
                    list.push(odd);
                    list.push('<div data-op-type="new-page" />');
                    console.log(
                        `最终结果是 ${
                            beforePageLength +
                            currentConfig.last_img_list.length +
                            1
                        } 页`
                    );
                } else {
                    console.log(
                        `最终结果是 ${
                            beforePageLength +
                            currentConfig.last_img_list.length
                        } 页`
                    );
                }
                // const odd2 = renderCover("./odd2.jpg");

                currentConfig.last_img_list.forEach((item, index) => {
                    const coverStr = renderCover(item);
                    list.push(coverStr);
                    if (index === currentConfig.last_img_list.length - 1) {
                        return;
                    }
                    list.push('<div data-op-type="new-page" />');
                });
                // 插入背景图片资源样式

                const style = document.createElement("style");
                // 定义你的 CSS 样式
                style.textContent = `
                    .nop-page-item.nop-page-item-odd .volume-mark.my-page-title {
                        background-image: url(${currentConfig.page_logo_src_left})
                    }
                    .nop-page-item.nop-page-item-even .volume-mark.my-page-title {
                        background-image: url(${currentConfig.page_logo_src_right})
                    }
                `;
                // 将 style 元素插入到 head 中
                document.head.appendChild(style);

                $("#content-box").html(list.join(""));
                bookConfig.start = true;
            }

            renderBook();
        </script>
    </body>
</html>
